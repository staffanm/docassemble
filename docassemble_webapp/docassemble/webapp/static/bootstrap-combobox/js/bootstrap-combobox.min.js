(function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.combobox.defaults,n),this.template=this.options.template||this.template,this.$source=e(t),this.$container=this.setup(),this.$element=this.$container.find("input[type=text]"),this.$target=this.$container.find("input[type=hidden]"),this.mousedover=!1,this.$source.attr("disabled")!==void 0&&this.$target.prop("disabled",!0),this.$button=this.$container.find(".dacomboboxtoggle"),this.$menu=e(this.options.menu).insertAfter(this.$element),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.clearIfNoMatch=this.options.clearIfNoMatch,this.shown=!1,this.selected=!1,this.refresh(),this.transferAttributes(),this.listen()};t.prototype={constructor:t,setup:function(){var t=e(this.template());return this.$source.before(t),this.$source.hide(),t},template:function(){return this.options.bsVersion=="2"?'<div class="combobox-container"><input type="hidden" /> <div class="input-append"> <input type="text" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-activedescendant="" autocomplete="off" /> <span class="add-on dropdown-toggle"> <span class="caret"/> <i class="icon-remove"/> </span> </div> </div>':'<div class="combobox-container"> <input type="hidden" /> <div class="input-group"> <input type="text" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-activedescendant="" autocomplete="off" /> <div class="input-group-append"> <button class="btn btn-outline-secondary dacomboboxtoggle" type="button" tabindex="-1" aria-label="'+this.options.buttonLabel+'" aria-expanded="false" aria-controls="id_controls"><span class="fas fa-caret-down"></span><span class="fas fa-xmark"></span></button> </div> </div> </div>'},disable:function(){this.$element.prop("disabled",!0),this.$button.attr("disabled",!0),this.disabled=!0,this.$container.addClass("combobox-disabled")},enable:function(){this.$element.prop("disabled",!1),this.$button.attr("disabled",!1),this.disabled=!1,this.$container.removeClass("combobox-disabled")},parse:function(){var n,o,i,l=this,a={},r={},c=[],t=!1,s="";return this.$source.find("option").each(function(){var n=e(this);if(n.val()===""){l.options.placeholder=n.text();return}a[n.text()]=n.val(),r[n.val()]=n.text(),c.push(n.text()),n.prop("selected")&&(t=n.text(),s=n.val())}),this.map=a,this.revMap=r,t?(o=!1,i=!1,n=this.$element.val(),n!==t&&(this.$element.val(t),o=!0),n=this.$target.val(),n!==s&&(this.$target.val(s),i=!0),this.$container.addClass("combobox-selected"),this.selected=!0,i&&this.$target.trigger("change"),o&&this.$element.trigger("change")):(this.$container.removeClass("combobox-selected"),this.selected=!1),c},transferAttributes:function(){if(this.options.placeholder=this.$source.attr("data-placeholder")||this.options.placeholder,this.options.appendId!=="undefined"&&(this.$element.attr("id",this.$source.attr("id")),this.$source.attr("id",this.$source.attr("id")+this.options.appendId),daComboBoxes[this.$element.attr("id")]=this),this.$menu.attr("id",this.$element.attr("id")+"menu"),this.$element.attr("aria-controls",this.$menu.attr("id")),this.$element.attr("aria-owns",this.$menu.attr("id")),this.$button.attr("aria-controls",this.$menu.attr("id")),this.$button.attr("aria-label",this.$source.attr("aria-label")),this.$button.attr("aria-labelledby",this.$source.attr("aria-labelledby")),this.$button.attr("aria-describedby",this.$source.attr("aria-describedby")),this.$element.attr("placeholder",this.options.placeholder),this.$target.prop("name",this.$source.prop("name")),this.$target.val(this.$source.val()),this.$source.removeAttr("name"),this.$element.attr("required",this.$source.attr("required")),this.$element.attr("rel",this.$source.attr("rel")),this.$element.attr("title",this.$source.attr("title")),this.$element.attr("class",this.$source.attr("class")),this.$element.attr("tabindex",this.$source.attr("tabindex")),this.$source.removeAttr("tabindex"),!this.$target.val()&&this.$source.data("default")){var e=this.$source.data("default");this.$element.val(e),this.$target.val(e)}this.$source.attr("disabled")!==void 0&&this.disable()},select:function(){var e,n,t=this.$menu.find(".active").attr("data-value"),s=!1,o=!1,i=!1;this.$container.parent().find(".da-has-error").remove(),e=this.$element.val(),n=this.updater(t),e!==n&&(this.$element.val(n),s=!0),e=this.$target.val(),e!==this.map[t]&&(this.$target.val(this.map[t]),o=!0),e=this.$source.val(),e!==this.map[t]&&(this.$source.val(this.map[t]),i=!0),this.$container.addClass("combobox-selected"),this.selected=!0,this.hide(),o&&this.$target.trigger("change"),s&&this.$element.trigger("change"),i&&this.$source.trigger("change")},manualSelect:function(e){var t,n=!1,s=!1,o=!1;this.$container.parent().find(".da-has-error").remove(),e!==""&&this.revMap[e]!==void 0?(this.$element.val(this.revMap[e]),n=!0):this.$element.val(e),t=this.$target.val(),t!==e&&(this.$target.val(e),o=!0),t=this.$source.val(),t!==e&&(this.$source.val(e),s=!0),e!==""&&n&&(this.$container.addClass("combobox-selected"),this.selected=!0),o&&this.$target.trigger("change"),this.$element.trigger("change"),s&&this.$source.trigger("change")},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:t.top+t.height,left:t.left}).show(),this.hidden=!1,this.$element.attr("aria-expanded",!0),this.$button.attr("aria-expanded",!0),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.hidden=!0,this.$element.on("blur",e.proxy(this.blur,this)),this.$element.attr("aria-expanded",!1),this.$button.attr("aria-expanded",!1),this.shown=!1,this},lookup:function(){this.query=this.$element.val(),this.process(this.source)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var t,n=[],s=[],o=[];t=e.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?s.push(t):o.push(t):n.push(t);return n.concat(s,o)},highlighter:function(e){var t=this.query.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return t?e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<b>"+t+"</b>"}):e},render:function(t){var n=this;return t=e(t).map(function(t,s){return t=e(n.options.item).attr("data-value",s).attr("aria-label",s),t.attr("id",n.$element.attr("id")+"-option-"+s),t.html(n.highlighter(s)),t[0]}),this.setActive(t.first()),this.$menu.html(t),this},setActive:function(e){e.addClass("active").attr("aria-selected",!0),this.$element.attr("aria-activedescendant",e.attr("id"))},swapActive:function(e,t){e.removeClass("active").attr("aria-selected",!1),this.setActive(t)},next:function(){var s=this.$menu.find('[aria-selected="true"]'),n=s.next();n.length||(n=e(this.$menu.find("li")[0])),this.swapActive(s,n)},prev:function(){var n=this.$menu.find('[aria-selected="true"]'),t=n.prev();t.length||(t=this.$menu.find("li").last()),this.swapActive(n,t)},toggle:function(e){return this.disabled||(this.$container.hasClass("combobox-selected")?(this.clearAll(),this.$element.attr("aria-expanded",!1),this.$button.attr("aria-expanded",!1)):this.shown?(this.$element.attr("aria-expanded",!1),this.$button.attr("aria-expanded",!1),this.hide()):(this.$element.attr("aria-expanded",!0),this.$button.attr("aria-expanded",!0),this.clearElement(),this.lookup())),e&&(e.preventDefault(),e.stopPropagation()),!1},clearAll:function(){var t=!1,n=!1,s=!1,e=this.$element.val();e!==""&&(this.$element.val(""),t=!0),e=this.$source.val(),e!==""&&(this.$source.val(""),n=!0),e=this.$target.val(),e!==""&&(this.$target.val(""),s=!0),this.$container.removeClass("combobox-selected"),s&&this.$target.trigger("change"),t&&this.$element.trigger("change"),n&&this.$source.trigger("change")},clearElement:function(){this.$element.val("").focus()},clearTarget:function(){this.$source.val(""),this.$target.val(""),this.$container.removeClass("combobox-selected"),this.selected=!1},refresh:function(){this.source=this.parse(),this.options.items=this.source.length},listen:function(){this.$element.on("focus",e.proxy(this.focus,this)).on("change",e.proxy(this.change,this)).on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this)).on("mouseleave","li",e.proxy(this.mouseleave,this)).on("mousedown","li",e.proxy(this.mousedown,this)),this.$button.on("click touchend",e.proxy(this.toggle,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev(),this.fixMenuScroll();break;case 40:e.preventDefault(),this.next(),this.fixMenuScroll();break}e.stopPropagation()},fixMenuScroll:function(){var t,n,s,o,e=this.$menu.find(".active");e.length&&(this.$element.attr("aria-activedescendant",e.attr("id")),t=e.position().top,n=t+e.height(),s=this.$menu.scrollTop(),o=this.$menu.height(),n>o?this.$menu.scrollTop(s+n-o):t<0&&this.$menu.scrollTop(s+t))},setActiveDescendant:function(t){this.mousedover&&this.swapActive(this.$menu.find(".active"),e(t.currentTarget))},keydown:function(t){this.suppressKeyPressRepeat=~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(t){switch(t.keyCode){case 40:this.shown||this.toggle();break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;if(this.selected){for(var i=this.$element.val(),s=this.$menu.find("li"),o=s.length,n=0;n<o;++n)if(e(s[n]).attr("data-value")==i)return t.stopPropagation(),t.preventDefault(),e(s[n]).click(),!1}else this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.clearTarget(),this.$target.val(this.$element.val()),this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(){this.focused=!0},blur:function(){var n,s,o,i,a,r,c,l,d=this;if(this.focused=!1,s=this.$element.val(),this.shown){i=this.$menu.find("li"),l=i.length;for(o=0;o<l;++o)if(e(i[o]).attr("data-value")==s){e(i[o]).click();return}}r=!1,c=!1,a=!1,this.clearIfNoMatch&&!this.selected&&s!==""&&(n=this.$element.val(),n!==""&&(this.$element.val(""),r=!0),n=this.$source.val(),n!==""&&(this.$source.val(""),c=!0),n=this.$target.val(),n!==""&&(this.$target.val(""),a=!0)),this.selected||(n=this.$target.val(),n!==s&&(this.$target.val(s),a=!0)),a&&this.$target.trigger("change"),r&&this.$element.trigger("change"),c&&this.$source.trigger("change"),!this.mousedover&&this.shown&&setTimeout(function(){d.hide()},200)},click:function(e){e&&(e.stopPropagation(),e.preventDefault()),daFetchAjaxTimeoutFetchAfter=!1,daFetchAcceptIncoming=!1,this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.setActiveDescendant(e)},mousedown:function(e){this.mousedover=!0,this.setActiveDescendant(e),this.mousedover=!1,this.hidden||e.target.tagName=="UL"&&this.$element.off("blur")},mouseleave:function(e){this.mousedover=!1,this.setActiveDescendant(e)}},e.fn.combobox=function(n){return this.each(function(){var o=e(this),s=o.data("combobox"),i=typeof n=="object"&&n;s||o.data("combobox",s=new t(this,i)),typeof n=="string"&&s[n]()})},e.fn.combobox.defaults={bsVersion:"5",menu:'<ul role="listbox" class="typeahead typeahead-long dropdown-menu"></ul>',item:'<li role="option" class="dropdown-item dapointer"></li>',appendId:"combobox",buttonLabel:"dropdown",clearIfNoMatch:!1},e.fn.combobox.Constructor=t})(window.jQuery)