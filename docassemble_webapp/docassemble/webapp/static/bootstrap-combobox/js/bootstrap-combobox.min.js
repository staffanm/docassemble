(function(b){var a=function(d,c){this.options=b.extend({},b.fn.combobox.defaults,c);this.template=this.options.template||this.template;this.$source=b(d);this.$container=this.setup();this.$element=this.$container.find("input[type=text]");this.$target=this.$container.find("input[type=hidden]");this.mousedover=false;if(this.$source.attr("disabled")!==undefined){this.$target.prop("disabled",true)}this.$button=this.$container.find(".dacomboboxtoggle");this.$menu=b(this.options.menu).insertAfter(this.$element);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.clearIfNoMatch=this.options.clearIfNoMatch;this.shown=false;this.selected=false;this.refresh();this.transferAttributes();this.listen()};a.prototype={constructor:a,setup:function(){var c=b(this.template());this.$source.before(c);this.$source.hide();return c},template:function(){if(this.options.bsVersion=="2"){return'<div class="combobox-container"><input type="hidden" /> <div class="input-append"> <input type="text" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-activedescendant="" autocomplete="off" /> <span class="add-on dropdown-toggle"> <span class="caret"/> <i class="icon-remove"/> </span> </div> </div>'}else{return'<div class="combobox-container"> <input type="hidden" /> <div class="input-group"> <input type="text" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-activedescendant="" autocomplete="off" /> <div class="input-group-append"> <button class="btn btn-outline-secondary dacomboboxtoggle" type="button" tabindex="-1" aria-expanded="false" aria-controls="id_controls"><span class="fas fa-caret-down"></span><span class="fas fa-xmark"></span></button> </div> </div> </div>'}},disable:function(){this.$element.prop("disabled",true);this.$button.attr("disabled",true);this.disabled=true;this.$container.addClass("combobox-disabled")},enable:function(){this.$element.prop("disabled",false);this.$button.attr("disabled",false);this.disabled=false;this.$container.removeClass("combobox-disabled")},parse:function(){var e=this,g={},f=[],d=false,c="";this.$source.find("option").each(function(){var h=b(this);if(h.val()===""){e.options.placeholder=h.text();return}g[h.text()]=h.val();f.push(h.text());if(h.prop("selected")){d=h.text();c=h.val()}});this.map=g;if(d){this.$element.val(d);this.$target.val(c);this.$container.addClass("combobox-selected");this.selected=true}return f},transferAttributes:function(){this.options.placeholder=this.$source.attr("data-placeholder")||this.options.placeholder;if(this.options.appendId!=="undefined"){this.$element.attr("id",this.$source.attr("id"));this.$source.attr("id",this.$source.attr("id")+this.options.appendId);daComboBoxes[this.$element.attr("id")]=this}this.$menu.attr("id",this.$element.attr("id")+"menu");this.$element.attr("aria-controls",this.$menu.attr("id"));this.$element.attr("aria-owns",this.$menu.attr("id"));this.$button.attr("aria-controls",this.$menu.attr("id"));this.$button.attr("aria-label",this.$source.attr("aria-label"));this.$button.attr("aria-labelledby",this.$source.attr("aria-labelledby"));this.$button.attr("aria-describedby",this.$source.attr("aria-describedby"));this.$element.attr("placeholder",this.options.placeholder);this.$target.prop("name",this.$source.prop("name"));this.$target.val(this.$source.val());this.$source.removeAttr("name");this.$element.attr("required",this.$source.attr("required"));this.$element.attr("rel",this.$source.attr("rel"));this.$element.attr("title",this.$source.attr("title"));this.$element.attr("class",this.$source.attr("class"));this.$element.attr("tabindex",this.$source.attr("tabindex"));this.$source.removeAttr("tabindex");if(!this.$target.val()&&this.$source.data("default")){var c=this.$source.data("default");this.$element.val(c);this.$target.val(c)}if(this.$source.attr("disabled")!==undefined){this.disable()}},select:function(){var d=this.$menu.find(".active").attr("data-value");var c;this.$container.parent().find(".da-has-error").remove();this.$element.val(this.updater(d));c=this.$target.val();if(c!=this.map[d]){this.$target.val(this.map[d])}c=this.$source.val();if(c!=this.map[d]){this.$source.val(this.map[d]).trigger("change")}this.$container.addClass("combobox-selected");this.selected=true;this.hide();return},updater:function(c){return c},show:function(){var c=b.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element).css({top:c.top+c.height,left:c.left}).show();this.hidden=false;this.$element.attr("aria-expanded",true);this.$button.attr("aria-expanded",true);this.shown=true;return this},hide:function(){this.$menu.hide();this.hidden=true;this.$element.on("blur",b.proxy(this.blur,this));this.$element.attr("aria-expanded",false);this.$button.attr("aria-expanded",false);this.shown=false;return this},lookup:function(c){this.query=this.$element.val();this.process(this.source)},process:function(c){var d=this;c=b.grep(c,function(e){return d.matcher(e)});c=this.sorter(c);if(!c.length){return this.shown?this.hide():this}return this.render(c.slice(0,this.options.items)).show()},matcher:function(c){return ~c.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var f=[],d=[],c=[],g;while((g=e.shift())){if(!g.toLowerCase().indexOf(this.query.toLowerCase())){f.push(g)}else{if(~g.indexOf(this.query)){d.push(g)}else{c.push(g)}}}return f.concat(d,c)},highlighter:function(c){var d=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");if(!d){return c}return c.replace(new RegExp("("+d+")","ig"),function(e,f){return"<b>"+f+"</b>"})},render:function(c){var d=this;c=b(c).map(function(e,f){e=b(d.options.item).attr("data-value",f).attr("aria-label",f);e.attr("id",d.$element.attr("id")+"-option-"+f);e.html(d.highlighter(f));return e[0]});this.setActive(c.first());this.$menu.html(c);return this},setActive:function(c){c.addClass("active").attr("aria-selected",true);this.$element.attr("aria-activedescendant",c.attr("id"))},swapActive:function(d,c){d.removeClass("active").attr("aria-selected",false);this.setActive(c)},next:function(d){var e=this.$menu.find('[aria-selected="true"]');var c=e.next();if(!c.length){c=b(this.$menu.find("li")[0])}this.swapActive(e,c)},prev:function(d){var e=this.$menu.find('[aria-selected="true"]');var c=e.prev();if(!c.length){c=this.$menu.find("li").last()}this.swapActive(e,c)},toggle:function(c){if(!this.disabled){if(this.$container.hasClass("combobox-selected")){this.clearTarget();this.$source.trigger("change");this.clearElement();this.$element.attr("aria-expanded",false);this.$button.attr("aria-expanded",false)}else{if(this.shown){this.$element.attr("aria-expanded",false);this.$button.attr("aria-expanded",false);this.hide()}else{this.$element.attr("aria-expanded",true);this.$button.attr("aria-expanded",true);this.clearElement();this.lookup()}}}if(c){c.preventDefault();c.stopPropagation()}return false},clearElement:function(){this.$element.val("").focus()},clearTarget:function(){this.$source.val("");this.$target.val("");this.$container.removeClass("combobox-selected");this.selected=false},refresh:function(){this.source=this.parse();this.options.items=this.source.length},listen:function(){this.$element.on("focus",b.proxy(this.focus,this)).on("change",b.proxy(this.change,this)).on("blur",b.proxy(this.blur,this)).on("keypress",b.proxy(this.keypress,this)).on("keyup",b.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",b.proxy(this.keydown,this))}this.$menu.on("click",b.proxy(this.click,this)).on("mouseenter","li",b.proxy(this.mouseenter,this)).on("mouseleave","li",b.proxy(this.mouseleave,this)).on("mousedown","li",b.proxy(this.mousedown,this));this.$button.on("click touchend",b.proxy(this.toggle,this))},eventSupported:function(c){var d=c in this.$element;if(!d){this.$element.setAttribute(c,"return;");d=typeof this.$element[c]==="function"}return d},move:function(c){if(!this.shown){return}switch(c.keyCode){case 9:case 13:case 27:c.preventDefault();break;case 38:c.preventDefault();this.prev();this.fixMenuScroll();break;case 40:c.preventDefault();this.next();this.fixMenuScroll();break}c.stopPropagation()},fixMenuScroll:function(){var f=this.$menu.find(".active");if(f.length){this.$element.attr("aria-activedescendant",f.attr("id"));var e=f.position().top;var c=e+f.height();var d=this.$menu.scrollTop();var g=this.$menu.height();if(c>g){this.$menu.scrollTop(d+c-g)}else{if(e<0){this.$menu.scrollTop(d+e)}}}},setActiveDescendant:function(c){if(this.mousedover){this.swapActive(this.$menu.find(".active"),b(c.currentTarget))}},keydown:function(c){this.suppressKeyPressRepeat=~b.inArray(c.keyCode,[40,38,9,13,27]);this.move(c)},keypress:function(c){if(this.suppressKeyPressRepeat){return}this.move(c)},keyup:function(f){switch(f.keyCode){case 40:if(!this.shown){this.toggle()}break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown){return}if(!this.selected){this.select()}else{var g=this.$element.val();var d=this.$menu.find("li");var h=d.length;for(var c=0;c<h;++c){if(b(d[c]).attr("data-value")==g){f.stopPropagation();f.preventDefault();b(d[c]).click();return false}}}break;case 27:if(!this.shown){return}this.hide();break;default:this.clearTarget();this.$target.val(this.$element.val());this.lookup()}f.stopPropagation();f.preventDefault()},focus:function(c){this.focused=true},blur:function(h){var g=this;this.focused=false;var j=this.$element.val();if(this.shown){var f=this.$menu.find("li");var k=f.length;for(var d=0;d<k;++d){if(b(f[d]).attr("data-value")==j){b(f[d]).click();return}}}var c;if(this.clearIfNoMatch&&!this.selected&&j!==""){this.$element.val("");c=this.$source.val();if(c!=""){this.$source.val("").trigger("change")}c=this.$target.val();if(c!=""){this.$target.val("")}}if(!this.selected){c=this.$target.val();if(c!=j){this.$target.val(j)}}if(!this.mousedover&&this.shown){setTimeout(function(){g.hide()},200)}},click:function(c){if(c){c.stopPropagation();c.preventDefault()}daFetchAjaxTimeoutFetchAfter=false;daFetchAcceptIncoming=false;this.select();this.$element.focus()},mouseenter:function(c){this.mousedover=true;this.setActiveDescendant(c)},mousedown:function(c){this.mousedover=true;this.setActiveDescendant(c);this.mousedover=false;if(!this.hidden){if(c.target.tagName=="UL"){this.$element.off("blur")}}},mouseleave:function(c){this.mousedover=false;this.setActiveDescendant(c)}};b.fn.combobox=function(c){return this.each(function(){var f=b(this),e=f.data("combobox"),d=typeof c=="object"&&c;if(!e){f.data("combobox",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.combobox.defaults={bsVersion:"5",menu:'<ul role="listbox" class="typeahead typeahead-long dropdown-menu"></ul>',item:'<li role="option" class="dropdown-item"></li>',appendId:"combobox",clearIfNoMatch:false};b.fn.combobox.Constructor=a})(window.jQuery);